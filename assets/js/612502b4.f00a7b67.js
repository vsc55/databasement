"use strict";(globalThis.webpackChunkdatabasement_docs=globalThis.webpackChunkdatabasement_docs||[]).push([[423],{8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>d});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}},9961:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"self-hosting/configuration/application","title":"Application","description":"Core application settings including database, timezone, proxy configuration, and logging.","source":"@site/docs/self-hosting/configuration/application.md","sourceDirName":"self-hosting/configuration","slug":"/self-hosting/configuration/application","permalink":"/databasement/self-hosting/configuration/application","draft":false,"unlisted":false,"editUrl":"https://github.com/David-Crty/databasement/tree/main/docs/docs/self-hosting/configuration/application.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"selfHostingSidebar","previous":{"title":"Configuration","permalink":"/databasement/self-hosting/configuration/"},"next":{"title":"Backup","permalink":"/databasement/self-hosting/configuration/backup"}}');var r=s(4848),t=s(8453);const o={sidebar_position:2},d="Application",a={},l=[{value:"Application Settings",id:"application-settings",level:2},{value:"Generating the Application Key",id:"generating-the-application-key",level:3},{value:"Timezone Configuration",id:"timezone-configuration",level:3},{value:"Database Configuration",id:"database-configuration",level:2},{value:"SQLite (Simplest)",id:"sqlite-simplest",level:3},{value:"MySQL / MariaDB",id:"mysql--mariadb",level:3},{value:"PostgreSQL",id:"postgresql",level:3},{value:"Reverse Proxy / Trusted Proxies",id:"reverse-proxy--trusted-proxies",level:2},{value:"Performance (Octane)",id:"performance-octane",level:2},{value:"Database Connection Usage",id:"database-connection-usage",level:3},{value:"Disabling Octane",id:"disabling-octane",level:3},{value:"Logging",id:"logging",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Enable Debug Mode",id:"enable-debug-mode",level:3},{value:"Debugging Trusted Proxies",id:"debugging-trusted-proxies",level:3},{value:"More troubleshooting",id:"more-troubleshooting",level:3},{value:"Run Artisan Commands",id:"run-artisan-commands",level:3},{value:"Get Help",id:"get-help",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"application",children:"Application"})}),"\n",(0,r.jsx)(n.p,{children:"Core application settings including database, timezone, proxy configuration, and logging."}),"\n",(0,r.jsx)(n.h2,{id:"application-settings",children:"Application Settings"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"APP_KEY"})}),(0,r.jsx)(n.td,{children:"Application encryption key (required)"}),(0,r.jsx)(n.td,{children:"-"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"APP_URL"})}),(0,r.jsx)(n.td,{children:"Full URL where the app is accessible"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"http://localhost:2226"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"APP_DEBUG"})}),(0,r.jsxs)(n.td,{children:["Enable debug mode (set to ",(0,r.jsx)(n.code,{children:"false"})," in production)"]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"TZ"})}),(0,r.jsx)(n.td,{children:"Application timezone"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"UTC"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"generating-the-application-key",children:"Generating the Application Key"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"APP_KEY"})," is required for encryption. Generate one with:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run --rm davidcrty/databasement:latest php artisan key:generate --show\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Copy the output (e.g., ",(0,r.jsx)(n.code,{children:"base64:xxxx..."}),") and set it as ",(0,r.jsx)(n.code,{children:"APP_KEY"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"timezone-configuration",children:"Timezone Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Set the ",(0,r.jsx)(n.code,{children:"TZ"})," environment variable to configure the application timezone."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"TZ=America/New_York\nTZ=Europe/London\nTZ=Asia/Tokyo\n"})}),"\n",(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.a,{href:"https://www.php.net/manual/en/timezones.php",children:"list of supported timezones"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"database-configuration",children:"Database Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Databasement needs a database to store its own data (users, servers, backup configurations)."}),"\n",(0,r.jsx)(n.h3,{id:"sqlite-simplest",children:"SQLite (Simplest)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"DB_CONNECTION=sqlite\nDB_DATABASE=/data/database.sqlite\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["When using SQLite, make sure to mount a volume for ",(0,r.jsx)(n.code,{children:"/data"})," to persist data."]})}),"\n",(0,r.jsx)(n.h3,{id:"mysql--mariadb",children:"MySQL / MariaDB"}),"\n",(0,r.jsx)(n.p,{children:"Create a database and user for Databasement on your MySQL server:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"MySQL:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE databasement CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\nCREATE USER 'databasement'@'%' IDENTIFIED BY 'your-secure-password';\nGRANT ALL PRIVILEGES ON databasement.* TO 'databasement'@'%';\nFLUSH PRIVILEGES;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"DB_CONNECTION=mysql\nDB_HOST=your-mysql-host\nDB_PORT=3306\nDB_DATABASE=databasement\nDB_USERNAME=databasement\nDB_PASSWORD=your-secure-password\n"})}),"\n",(0,r.jsx)(n.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,r.jsx)(n.p,{children:"Create a database and user for Databasement on your PostgreSQL server:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"PostgreSQL:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE databasement;\nCREATE USER databasement WITH ENCRYPTED PASSWORD 'your-secure-password';\nGRANT ALL PRIVILEGES ON DATABASE databasement TO databasement;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"DB_CONNECTION=pgsql\nDB_HOST=your-postgres-host\nDB_PORT=5432\nDB_DATABASE=databasement\nDB_USERNAME=databasement\nDB_PASSWORD=your-secure-password\n"})}),"\n",(0,r.jsx)(n.h2,{id:"reverse-proxy--trusted-proxies",children:"Reverse Proxy / Trusted Proxies"}),"\n",(0,r.jsxs)(n.p,{children:["When running behind a reverse proxy (nginx, Traefik, Kubernetes Ingress), configure trusted proxies so Laravel can\ncorrectly determine the client IP and protocol. See the ",(0,r.jsx)(n.a,{href:"#troubleshooting",children:"Troubleshooting section"})," if you have issues\nwith proxy configuration."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"})]})}),(0,r.jsx)(n.tbody,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"TRUSTED_PROXIES"})}),(0,r.jsx)(n.td,{children:"IP addresses or CIDR ranges of trusted proxies"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"127.0.0.0/8,10.0.0.0/8,100.64.0.0/10,169.254.0.0/16,172.16.0.0/12,192.168.0.0/16"})})]})})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Alternative values:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"*"})," - Trust all proxies (simplest option for containerized environments)"]}),"\n",(0,r.jsxs)(n.li,{children:["Comma-separated IPs/CIDRs: ",(0,r.jsx)(n.code,{children:"10.0.0.1,192.168.1.0/24"})," - Trust specific proxies only"]}),"\n",(0,r.jsx)(n.li,{children:"Empty - Trust no proxies"}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Checks the ",(0,r.jsx)(n.a,{href:"#troubleshooting",children:"Troubleshooting section"})," for help with proxy configuration."]})}),"\n",(0,r.jsx)(n.h2,{id:"performance-octane",children:"Performance (Octane)"}),"\n",(0,r.jsxs)(n.p,{children:["Databasement uses ",(0,r.jsx)(n.a,{href:"https://laravel.com/docs/octane",children:"Laravel Octane"})," with FrankenPHP in production Docker images for improved performance. Octane keeps the application in memory between requests, avoiding the overhead of bootstrapping on every request."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"OCTANE_ENABLED"})}),(0,r.jsx)(n.td,{children:"Enable Octane worker mode"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"true"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"OCTANE_WORKERS"})}),(0,r.jsxs)(n.td,{children:["Number of Octane worker processes. Use ",(0,r.jsx)(n.code,{children:"auto"})," for 2x CPU cores."]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"OCTANE_MAX_REQUESTS"})}),(0,r.jsx)(n.td,{children:"Requests before a worker restarts (prevents memory leaks)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"500"})})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"database-connection-usage",children:"Database Connection Usage"}),"\n",(0,r.jsx)(n.p,{children:"Each long-lived process maintains its own database connection. The expected number of connections is:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Total connections = 1 (Octane main) + OCTANE_WORKERS + 1 (queue worker) + 1 (scheduler)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Default:"})," ",(0,r.jsx)(n.code,{children:"1 + 2 + 1 + 1 = 5 connections"})]}),"\n",(0,r.jsx)(n.h3,{id:"disabling-octane",children:"Disabling Octane"}),"\n",(0,r.jsx)(n.p,{children:"To disable Octane and use classic FrankenPHP mode (ephemeral processes, lower memory):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"OCTANE_ENABLED=false\n"})}),"\n",(0,r.jsx)(n.p,{children:"With Octane disabled, only background processes maintain persistent connections:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Total connections = 1 (queue worker) + 1 (scheduler) = 2 connections\n"})}),"\n",(0,r.jsx)(n.h2,{id:"logging",children:"Logging"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Default"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"LOG_CHANNEL"})}),(0,r.jsx)(n.td,{children:"Logging channel"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"stderr"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"LOG_LEVEL"})}),(0,r.jsx)(n.td,{children:"Minimum log level"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"debug"})})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["For production, ",(0,r.jsx)(n.code,{children:"stderr"})," is recommended as logs will be captured by Docker."]}),"\n",(0,r.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsxs)(n.p,{children:["Here's a complete ",(0,r.jsx)(n.code,{children:".env"})," file for a production deployment with MySQL:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Application\nAPP_DEBUG=false\nAPP_URL=https://backup.yourdomain.com\nAPP_KEY=base64:your-generated-key-here\n\n# Database (for Databasement itself)\nDB_CONNECTION=mysql\nDB_HOST=mysql.yourdomain.com\nDB_PORT=3306\nDB_DATABASE=databasement\nDB_USERNAME=databasement\nDB_PASSWORD=secure-password-here\n\n# Logging\nLOG_CHANNEL=stderr\nLOG_LEVEL=warning\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"enable-debug-mode",children:"Enable Debug Mode"}),"\n",(0,r.jsx)(n.p,{children:"Enable debug mode to access detailed diagnostics:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"APP_DEBUG=true\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then visit ",(0,r.jsx)(n.code,{children:"https://your-domain.com/health/debug"})," to view:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Current IP address and whether it's from a trusted proxy"}),"\n",(0,r.jsxs)(n.li,{children:["Request headers (including ",(0,r.jsx)(n.code,{children:"X-Forwarded-For"}),", ",(0,r.jsx)(n.code,{children:"X-Forwarded-Proto"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Application configuration"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"debugging-trusted-proxies",children:"Debugging Trusted Proxies"}),"\n",(0,r.jsx)(n.p,{children:"If your application shows HTTP instead of HTTPS, or shows the wrong client IP:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Enable debug mode"})," (see above)"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Visit ",(0,r.jsx)(n.code,{children:"/health/debug"})]})," and check:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"is_trusted_proxy"}),": Should be ",(0,r.jsx)(n.code,{children:"true"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"secure"}),": Should be ",(0,r.jsx)(n.code,{children:"true"})," for HTTPS"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"headers"}),": Check ",(0,r.jsx)(n.code,{children:"x-forwarded-for"})," and ",(0,r.jsx)(n.code,{children:"x-forwarded-proto"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common issues:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"is_trusted_proxy: false"})," \u2192 The proxy IP is not in your ",(0,r.jsx)(n.code,{children:"TRUSTED_PROXIES"})," list"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"secure: false"})," with HTTPS \u2192 Trusted proxy not configured, so ",(0,r.jsx)(n.code,{children:"x-forwarded-proto"})," header is ignored"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Quick fix:"})," Set ",(0,r.jsx)(n.code,{children:"TRUSTED_PROXIES=*"})," to trust all proxies"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"more-troubleshooting",children:"More troubleshooting"}),"\n",(0,r.jsxs)(n.p,{children:["If you encounter issues, see the ",(0,r.jsx)(n.a,{href:"../docker-compose#troubleshooting",children:"Docker Compose Troubleshooting"})," section for common problems and solutions."]}),"\n",(0,r.jsxs)(n.p,{children:["See also ",(0,r.jsx)(n.a,{href:"../../user-guide/database-servers#docker-networking",children:"Docker Networking"})," if you're having issues connecting to your database server."]}),"\n",(0,r.jsx)(n.h3,{id:"run-artisan-commands",children:"Run Artisan Commands"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"php artisan migrate:status # Check database migrations\nphp artisan config:show database # View database configuration\n"})}),"\n",(0,r.jsx)(n.h3,{id:"get-help",children:"Get Help"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Check the logs: ",(0,r.jsx)(n.code,{children:"docker compose logs app"})]}),"\n",(0,r.jsxs)(n.li,{children:["Report issues on ",(0,r.jsx)(n.a,{href:"https://github.com/david-crty/databasement/issues",children:"GitHub"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);